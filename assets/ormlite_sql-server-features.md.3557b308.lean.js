import{_ as n,c as s,o as a,a as t}from"./app.64b20f26.js";const y='{"title":"SQL Server Features","description":"","frontmatter":{"title":"SQL Server Features"},"headers":[{"level":2,"title":"SQL Server 2012 Sequences","slug":"sql-server-2012-sequences"},{"level":2,"title":"SQL Server Table Hints","slug":"sql-server-table-hints"},{"level":2,"title":"Memory Optimized Tables","slug":"memory-optimized-tables"},{"level":2,"title":"SQL Server Types","slug":"sql-server-types"},{"level":2,"title":"SqlServer 2012 Connection String","slug":"sqlserver-2012-connection-string"},{"level":3,"title":"Example Usage","slug":"example-usage"}],"relativePath":"ormlite/sql-server-features.md","lastUpdated":1645007721717}',e={},p=t(`__VP_STATIC_START__<h2 id="sql-server-2012-sequences" tabindex="-1">SQL Server 2012 Sequences <a class="header-anchor" href="#sql-server-2012-sequences" aria-hidden="true">#</a></h2><p>The <code>[Sequence]</code> attribute can be used as an alternative to <code>[AutoIncrement]</code> for inserting rows with an auto incrementing integer value populated by SQL Server, but instead of needing an <code>IDENTITY</code> column it can populate a normal <code>INT</code> column from a user-defined Sequence, e.g:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SequenceTest</span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Sequence</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Seq_SequenceTest_Id&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">,</span> <span class="token class-name">ReturnOnInsert</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Name <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> UserName <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Email <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>

    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">Sequence</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token string">&quot;Seq_Counter&quot;</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">int</span></span> Counter <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token class-name"><span class="token keyword">var</span></span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">SequenceTest</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;me&quot;</span><span class="token punctuation">,</span> Email <span class="token operator">=</span> <span class="token string">&quot;me@mydomain.com&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span>Id <span class="token comment">//= Populated by next value in &quot;Seq_SequenceTest_Id&quot; SQL Server Sequence</span>
</code></pre></div><p>The new <code>[ReturnOnInsert]</code> attribute tells OrmLite which columns to return the values of, in this case it returns the new Sequence value the row was inserted with. Sequences offer more flexibility than <code>IDENTITY</code> columns where you can use multiple sequences in a table or have the same sequence shared across multiple tables.</p><p>When creating tables, OrmLite will also create any missing Sequences automatically so you can continue to have reproducible tests and consistent Startups states that&#39;s unreliant on external state. But it doesn&#39;t drop sequences when OrmLite drops the table as they could have other external dependents.</p><p>To be able to use the new sequence support you&#39;ll need to use an SQL Server dialect greater than SQL Server 2012+, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> dbFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteConnectionFactory</span><span class="token punctuation">(</span>connString<span class="token punctuation">,</span> SqlServer2012Dialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sql-server-table-hints" tabindex="-1">SQL Server Table Hints <a class="header-anchor" href="#sql-server-table-hints" aria-hidden="true">#</a></h2><p>Using the same JOIN Filter feature OrmLite also lets you add SQL Server Hints on JOIN Table expressions, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> q <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Car<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Join</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Car<span class="token punctuation">,</span> CarType<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">(</span>c<span class="token punctuation">,</span> t<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> c<span class="token punctuation">.</span>CarId <span class="token operator">==</span> t<span class="token punctuation">.</span>CarId<span class="token punctuation">,</span> SqlServerTableHint<span class="token punctuation">.</span>ReadUncommitted<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Which emits the appropriate SQL Server hints:</p><div class="language-sql"><pre><code><span class="token keyword">SELECT</span> <span class="token string">&quot;Car&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;CarId&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;CarType&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;CarTypeName&quot;</span> 
<span class="token keyword">FROM</span> <span class="token string">&quot;Car&quot;</span> <span class="token keyword">INNER</span> <span class="token keyword">JOIN</span> <span class="token string">&quot;CarType&quot;</span> <span class="token keyword">WITH</span> <span class="token punctuation">(</span>READUNCOMMITTED<span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token punctuation">(</span><span class="token string">&quot;Car&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;CarId&quot;</span> <span class="token operator">=</span> <span class="token string">&quot;CarType&quot;</span><span class="token punctuation">.</span><span class="token string">&quot;CarId&quot;</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="memory-optimized-tables" tabindex="-1">Memory Optimized Tables <a class="header-anchor" href="#memory-optimized-tables" aria-hidden="true">#</a></h2><p>OrmLite allows access to many advanced SQL Server features including <a href="https://msdn.microsoft.com/en-us/library/dn133165.aspx" target="_blank" rel="noopener noreferrer">Memory-Optimized Tables</a> where you can tell SQL Server to maintain specific tables in Memory using the <code>[SqlServerMemoryOptimized]</code> attribute, e.g:</p><div class="language-csharp"><pre><code><span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SqlServerMemoryOptimized</span><span class="token attribute-arguments"><span class="token punctuation">(</span>SqlServerDurability<span class="token punctuation">.</span>SchemaOnly<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">SqlServerMemoryOptimizedCacheEntry</span> <span class="token punctuation">:</span> <span class="token type-list"><span class="token class-name">ICacheEntry</span></span>
<span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">PrimaryKey</span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StringLength</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StringLengthAttribute<span class="token punctuation">.</span>MaxText<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">SqlServerBucketCount</span><span class="token attribute-arguments"><span class="token punctuation">(</span><span class="token number">10000000</span><span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">StringLength</span><span class="token attribute-arguments"><span class="token punctuation">(</span>StringLengthAttribute<span class="token punctuation">.</span>MaxText<span class="token punctuation">)</span></span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">string</span></span> Data <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> CreatedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime<span class="token punctuation">?</span></span> ExpiryDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">DateTime</span> ModifiedDate <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The <code>[SqlServerBucketCount]</code> attribute can be used to <a href="https://msdn.microsoft.com/en-us/library/mt706517.aspx#configuring_bucket_count" target="_blank" rel="noopener noreferrer">configure the bucket count for a hash index</a> whilst the new <code>[SqlServerCollate]</code> attribute can be used to specify an SQL Server collation.</p><h2 id="sql-server-types" tabindex="-1">SQL Server Types <a class="header-anchor" href="#sql-server-types" aria-hidden="true">#</a></h2><p>OrmLite can be extended to support new Types using SQL Server Special Type Converters which currently adds support for the SQL Server-specific <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite.SqlServer.Converters/SqlServerGeographyTypeConverter.cs" target="_blank" rel="noopener noreferrer">SqlGeography</a>, <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite.SqlServer.Converters/SqlServerGeometryTypeConverter.cs" target="_blank" rel="noopener noreferrer">SqlGeometry</a> and <a href="https://github.com/ServiceStack/ServiceStack.OrmLite/blob/master/src/ServiceStack.OrmLite.SqlServer.Converters/SqlServerHierarchyIdTypeConverter.cs" target="_blank" rel="noopener noreferrer">SqlHierarchyId</a> Types.</p><p>Since these Types require an external dependency to the <strong>Microsoft.SqlServer.Types</strong> NuGet package they&#39;re contained in a separate NuGet package that can be installed with:</p><div class="language-"><pre><code>PM&gt; Install-Package ServiceStack.OrmLite.SqlServer.Converters
</code></pre></div><p>Once installed, all available SQL Server Types can be registered on your SQL Server Provider with:</p><div class="language-csharp"><pre><code>SqlServerConverters<span class="token punctuation">.</span><span class="token function">Configure</span><span class="token punctuation">(</span>SqlServer2012Dialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="sqlserver-2012-connection-string" tabindex="-1">SqlServer 2012 Connection String <a class="header-anchor" href="#sqlserver-2012-connection-string" aria-hidden="true">#</a></h2><p>In addition to using <code>SqlServer2012Dialect.Provider</code> you&#39;ll also need to specify you&#39;re using MSSQL 2012 on the connection string by adding the <code>;Type System Version=SQL Server 2012;</code> suffix, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> dbFactory <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">OrmLiteConnectionFactory</span><span class="token punctuation">(</span>
  <span class="token string">&quot;Server=host;Database=db;User Id=sa;Password=test;Type System Version=SQL Server 2012&quot;</span><span class="token punctuation">,</span>
  SqlServer2012Dialect<span class="token punctuation">.</span>Provider<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> db <span class="token operator">=</span> dbFactory<span class="token punctuation">.</span><span class="token function">OpenDbConnection</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="example-usage" tabindex="-1">Example Usage <a class="header-anchor" href="#example-usage" aria-hidden="true">#</a></h3><p>After the Converters are registered they can treated like a normal .NET Type, e.g:</p><p><strong>SqlHierarchyId</strong> Example:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Node</span> <span class="token punctuation">{</span>
    <span class="token punctuation">[</span><span class="token attribute"><span class="token class-name">AutoIncrement</span></span><span class="token punctuation">]</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">SqlHierarchyId</span> TreeId <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DropAndCreateTable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> treeId <span class="token operator">=</span> SqlHierarchyId<span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;/1/1/3/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 0x5ADE is hex</span>
db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">Node</span> <span class="token punctuation">{</span> TreeId <span class="token operator">=</span> treeId <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> parent <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">Scalar</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>SqlHierarchyId<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span>
    db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">From</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Node<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Select</span><span class="token punctuation">(</span><span class="token string">&quot;TreeId.GetAncestor(1)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
parent<span class="token punctuation">.</span><span class="token function">ToString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">//= /1/1/</span>
</code></pre></div><p><strong>SqlGeography</strong> and <strong>SqlGeometry</strong> Example:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">GeoTest</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">long</span></span> Id <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">SqlGeography</span> Location <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token return-type class-name">SqlGeometry</span> Shape <span class="token punctuation">{</span> <span class="token keyword">get</span><span class="token punctuation">;</span> <span class="token keyword">set</span><span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">DropAndCreateTable</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GeoTest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token class-name"><span class="token keyword">var</span></span> geo <span class="token operator">=</span> SqlGeography<span class="token punctuation">.</span><span class="token function">Point</span><span class="token punctuation">(</span><span class="token number">40.6898329</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">74.0452177</span><span class="token punctuation">,</span> <span class="token number">4326</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Statue of Liberty</span>

<span class="token comment">// A simple line from (0,0) to (4,4)  Length = SQRT(2 * 4^2)</span>
<span class="token class-name"><span class="token keyword">var</span></span> wkt <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">System<span class="token punctuation">.</span>Data<span class="token punctuation">.</span>SqlTypes<span class="token punctuation">.</span>SqlChars</span><span class="token punctuation">(</span><span class="token string">&quot;LINESTRING(0 0,4 4)&quot;</span><span class="token punctuation">.</span><span class="token function">ToCharArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> shape <span class="token operator">=</span> SqlGeometry<span class="token punctuation">.</span><span class="token function">STLineFromText</span><span class="token punctuation">(</span>wkt<span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

db<span class="token punctuation">.</span><span class="token function">Insert</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token constructor-invocation class-name">GeoTestTable</span> <span class="token punctuation">{</span> Id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">,</span> Location <span class="token operator">=</span> geo<span class="token punctuation">,</span> Shape <span class="token operator">=</span> shape <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> dbShape <span class="token operator">=</span> db<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">SingleById</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>GeoTest<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">.</span>Shape<span class="token punctuation">;</span>

<span class="token keyword">new</span> <span class="token punctuation">{</span> dbShape<span class="token punctuation">.</span><span class="token function">STEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>STX<span class="token punctuation">,</span> dbShape<span class="token punctuation">.</span><span class="token function">STEndPoint</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>STY <span class="token punctuation">}</span><span class="token punctuation">.</span><span class="token function">PrintDump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>Output:</p><div class="language-"><pre><code>{
    STX: 4,
    STY: 4
}
</code></pre></div>__VP_STATIC_END__`,33),o=[p];function c(l,u,r,i,k,d){return a(),s("div",null,o)}var S=n(e,[["render",c]]);export{y as __pageData,S as default};
