import{_ as n,c as s,o as a,a as t}from"./app.64b20f26.js";const f='{"title":"Redis Custom Commands","description":"","frontmatter":{"slug":"custom-commands","title":"Redis Custom Commands"},"relativePath":"redis/custom-commands.md","lastUpdated":1645007721741}',p={},o=t(`__VP_STATIC_START__<p>Most of the time when waiting to use a new <a href="http://redis.io/commands" target="_blank" rel="noopener noreferrer">Redis Command</a> you&#39;ll need to wait for an updated version of <strong>ServiceStack.Redis</strong> to add support for the new commands likewise there are times when the Redis Client doesn&#39;t offer every permutation that redis-server supports.</p><p>With the new <code>Custom</code> and <code>RawCommand</code> APIs on <code>IRedisClient</code> and <code>IRedisNativeClient</code> you can now use the RedisClient to send your own custom commands that can call adhoc Redis commands:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRedisClient</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token return-type class-name">RedisText</span> <span class="token function">Custom</span><span class="token punctuation">(</span><span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> cmdWithArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">IRedisNativeClient</span>
<span class="token punctuation">{</span>
    <span class="token range operator">..</span><span class="token punctuation">.</span>
    <span class="token return-type class-name">RedisData</span> <span class="token function">RawCommand</span><span class="token punctuation">(</span><span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">object</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> cmdWithArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token return-type class-name">RedisData</span> <span class="token function">RawCommand</span><span class="token punctuation">(</span><span class="token keyword">params</span> <span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> cmdWithBinaryArgs<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>These Custom APIs take a flexible <code>object[]</code> arguments which accepts any serializable value e.g. <code>byte[]</code>, <code>string</code>, <code>int</code> as well as any user-defined Complex Types which are transparently serialized as JSON and send across the wire as UTF-8 bytes.</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span><span class="token string">&quot;SET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// ret.Text = &quot;OK&quot;</span>

<span class="token class-name"><span class="token keyword">byte</span><span class="token punctuation">[</span><span class="token punctuation">]</span></span> cmdSet <span class="token operator">=</span> Commands<span class="token punctuation">.</span>Set<span class="token punctuation">;</span>
ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>cmdSet<span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;b&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>           <span class="token comment">// ret.Text = &quot;OK&quot;</span>

ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                 <span class="token comment">// ret.Text = &quot;1&quot;</span>
</code></pre></div><p>There are also <a href="https://github.com/ServiceStack/ServiceStack.Redis/blob/master/src/ServiceStack.Redis/RedisDataExtensions.cs" target="_blank" rel="noopener noreferrer">convenient extension methods</a> on <code>RedisData</code> and <code>RedisText</code> that make it easy to access structured data, e.g:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>Keys<span class="token punctuation">,</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> keys <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">GetResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                      <span class="token comment">// keys = [&quot;foo&quot;, &quot;bar&quot;]</span>

ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>MGet<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> values <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">GetResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>                    <span class="token comment">// values = [&quot;1&quot;, &quot;b&quot;]</span>

Enum<span class="token punctuation">.</span><span class="token function">GetNames</span><span class="token punctuation">(</span><span class="token keyword">typeof</span><span class="token punctuation">(</span><span class="token type-expression class-name">DayOfWeek</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ToList</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">ForEach</span><span class="token punctuation">(</span>x <span class="token operator">=&gt;</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>RPush<span class="token punctuation">,</span> <span class="token string">&quot;DaysOfWeek&quot;</span><span class="token punctuation">,</span> x<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>LRange<span class="token punctuation">,</span> <span class="token string">&quot;DaysOfWeek&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token class-name"><span class="token keyword">var</span></span> weekDays <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token function">GetResults</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>      

weekDays<span class="token punctuation">.</span><span class="token function">PrintDump</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// [&quot;Monday&quot;, &quot;Tuesday&quot;, &quot;Wednesday&quot;, &quot;Thursday&quot;, &quot;Friday&quot;]</span>
</code></pre></div><p>and some more examples using Complex Types with the Custom APIs:</p><div class="language-csharp"><pre><code><span class="token class-name"><span class="token keyword">var</span></span> ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>Set<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">Poco</span> <span class="token punctuation">{</span> Name <span class="token operator">=</span> <span class="token string">&quot;Bar&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ret.Text = &quot;OK&quot;</span>

ret <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>Commands<span class="token punctuation">.</span>Get<span class="token punctuation">,</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>          <span class="token comment">// ret.Text =  {&quot;Name&quot;:&quot;Bar&quot;}</span>
<span class="token class-name">Poco</span> dto <span class="token operator">=</span> ret<span class="token punctuation">.</span><span class="token generic-method"><span class="token function">GetResult</span><span class="token generic class-name"><span class="token punctuation">&lt;</span>Poco<span class="token punctuation">&gt;</span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

dto<span class="token punctuation">.</span>Name<span class="token punctuation">.</span><span class="token function">Print</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// Bar</span>
</code></pre></div><p>This API is used in most of Redis React UI&#39;s <a href="https://github.com/ServiceStackApps/RedisReact/blob/master/src/RedisReact/RedisReact/js/redis.js" target="_blank" rel="noopener noreferrer">redis.js</a> JavaScript client library where Redis server commands are made available via the <a href="https://github.com/ServiceStackApps/RedisReact/blob/a1b66603d52d2f18b96227fc455ecb5323e424c8/src/RedisReact/RedisReact.ServiceInterface/RedisServices.cs#L73" target="_blank" rel="noopener noreferrer">single ServiceStack Service</a>:</p><div class="language-csharp"><pre><code><span class="token keyword">public</span> <span class="token return-type class-name"><span class="token keyword">object</span></span> <span class="token function">Any</span><span class="token punctuation">(</span><span class="token class-name">CallRedis</span> request<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token class-name"><span class="token keyword">var</span></span> args <span class="token operator">=</span> request<span class="token punctuation">.</span>Args<span class="token punctuation">.</span><span class="token function">ToArray</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token class-name"><span class="token keyword">var</span></span> response <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token constructor-invocation class-name">CallRedisResponse</span> <span class="token punctuation">{</span> Result <span class="token operator">=</span> Redis<span class="token punctuation">.</span><span class="token function">Custom</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> response<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div>__VP_STATIC_END__`,11),e=[o];function c(u,l,i,k,r,d){return a(),s("div",null,e)}var y=n(p,[["render",c]]);export{f as __pageData,y as default};
